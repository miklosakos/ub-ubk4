From e6f5c449d8b0d4a5558e81422646e700e2c1ec72 Mon Sep 17 00:00:00 2001
From: Darcy Shen <sadhen@zoho.com>
Date: Sun, 26 Jan 2020 16:21:17 +0000
Subject: [PATCH] Graphviz: Prefer python3

---
 plugins/graphviz/progs/init-graphviz.scm | 16 ++++++++++++++--
 1 file changed, 14 insertions(+), 2 deletions(-)

diff --git a/plugins/graphviz/progs/init-graphviz.scm b/plugins/graphviz/progs/init-graphviz.scm
index 681dfb7e8..59210bb97 100644
--- a/plugins/graphviz/progs/init-graphviz.scm
+++ b/plugins/graphviz/progs/init-graphviz.scm
@@ -16,17 +16,29 @@
       (with s (texmacs->code (stree->tree u) "SourceCode")
         (string-append s "\n<EOF>\n"))))
 
+(define (python-launcher)
+  (if (url-exists-in-path? "python3")
+      "python3"
+      "python2"))
+
+(define (python-exists?)
+  (or (url-exists-in-path? "python3")
+      (url-exists-in-path? "python2")))
+
 (define (graphviz-launcher)
   (if (url-exists? "$TEXMACS_HOME_PATH/plugins/tmpy")
-      (string-append "python \""
+      (string-append (python-launcher)
+                     " \""
                      (getenv "TEXMACS_HOME_PATH")
                      "/plugins/tmpy/session/tm_graphviz.py\"")
-      (string-append "python \""
+      (string-append (python-launcher)
+                     " \""
                      (getenv "TEXMACS_PATH")
                      "/plugins/tmpy/session/tm_graphviz.py\"")))
 
 (plugin-configure graphviz 
   (:require (url-exists-in-path? "dot"))
+  (:require (python-exists?))
   (:launch ,(graphviz-launcher))
   (:serializer ,graphviz-serialize)
   (:session "Graphviz"))
