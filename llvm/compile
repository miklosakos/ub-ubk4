#!/bin/sh -eux

# ha BUILD_SHARED_LIBS=ON:
# LLVM_BUILD_LLVM_DYLIB=OFF / LLVM_LINK_LLVM_DYLIB=OFF
# másképp nem működik

ffi_cflags=$(pkg-config --cflags-only-I libffi)
ffi_ldflags=$(pkg-config --libs-only-L libffi)

ub_compile \
	-DBUILD_SHARED_LIBS=OFF \
	-DFFI_INCLUDE_DIR="${ffi_cflags#-I}" \
	-DFFI_LIBRARY_DIR="${ffi_ldflags#-L}" \
	-DLLVM_BINUTILS_INCDIR=/usr/include \
	-DLLVM_BUILD_DOCS=ON \
	-DLLVM_BUILD_LLVM_DYLIB=ON \
	-DLLVM_CCACHE_BUILD=ON \
	-DLLVM_ENABLE_ASSERTIONS=OFF \
	-DLLVM_ENABLE_DOXYGEN=OFF \
	-DLLVM_ENABLE_EXPENSIVE_CHECKS=OFF \
	-DLLVM_ENABLE_FFI=ON \
	-DLLVM_ENABLE_PROJECTS="clang;compiler-rt;lld" \
	-DLLVM_ENABLE_RTTI=ON \
	-DLLVM_ENABLE_SPHINX=ON \
	-DLLVM_INCLUDE_TESTS=OFF \
	-DLLVM_LINK_LLVM_DYLIB=ON \
	-DLLVM_TARGETS_TO_BUILD="AMDGPU;X86" \
	-DLLVM_TOOL_LIBCXX_BUILD=OFF \
	-DSPHINX_WARNINGS_AS_ERRORS=OFF \
	-DWITH_POLLY=OFF
